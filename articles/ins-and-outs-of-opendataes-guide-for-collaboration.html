<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ins and outs  of opendataes: a guide for collaboration • opendataes</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- Google Fonts --><link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&amp;family=Roboto:wght@100;300;400;500;700&amp;display=swap" rel="stylesheet">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- Hugo Universal --><link href="../style.violet.css" rel="stylesheet">
<!-- rOpenSpain --><link href="../ropenspain.css" rel="stylesheet">
<meta property="og:title" content="Ins and outs  of opendataes: a guide for collaboration">
<meta property="og:description" content="opendataes">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed btn-template-main" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <i class="fa fa-align-justify"></i>
      </button>
      <span class="navbar-brand" id="ROS-navbar-brand">
      <a class="navbar-link ROS-black" href="../index.html"><img src="../logo.png" alt="opendataes-logo" id="ROS-navbar-logo">opendataes</a> <span class="version label label-default hidden-xs" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ins-and-outs-of-opendataes-guide-for-collaboration.html">Ins and outs  of opendataes: a guide for collaboration</a>
    </li>
    <li>
      <a href="../articles/understanding-opendataes-a-case-study-approach.html">Understanding opendataes: a case study approach</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/ropenspain/opendataes/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>  <!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->


      

      </header><script src="ins-and-outs-of-opendataes-guide-for-collaboration_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Ins and outs of opendataes: a guide for collaboration</h1>
                        <h4 class="author">Jorge Cimentada and Jorge Lopez</h4>
            
            <h4 class="date">2021-02-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropenspain/opendataes/blob/master/vignettes/ins-and-outs-of-opendataes-guide-for-collaboration.Rmd"><code>vignettes/ins-and-outs-of-opendataes-guide-for-collaboration.Rmd</code></a></small>
      <div class="hidden name"><code>ins-and-outs-of-opendataes-guide-for-collaboration.Rmd</code></div>

    </div>

    
    
<p><code>opendataes</code> is package that was ultimately though of to be maintained by the R community. The package is extremely useful in automating some tasks but also limited in some aspects. This vignette is aimed at describing in detail how the package works so that new users can understand the inner workings of <code>opendataes</code> and contribute more easily.</p>
<div id="how-does-this-work-anyway" class="section level2">
<h2 class="hasAnchor">
<a href="#how-does-this-work-anyway" class="anchor"></a>How does this work anyway?</h2>
<p><img src="opendataes_diagram.jpeg" width="1200" height="900" style="display: block; margin: auto;"></p>
<p><br></p>
<p>Woah, that’s a lot of information. The package has three steps:</p>
<ol style="list-style-type: decimal">
<li>Preparing the path and requesting data from the API</li>
<li>Extracting the metadata</li>
<li>Extracting the data</li>
</ol>
<p>In the image above, the first step is the horizontal diagram at the top while the last two steps are the horizontal diagrams at the bottom. We’ll go step by step and tear it apart. First, let’s look at the legend of each box</p>
<p><br></p>
<p><img src="opendataes_diagram_legend.jpeg" width="800" height="200" style="display: block; margin: auto;"></p>
<p>I’ll explain it further just to make it clearer. The red boxes are information boxes. That is, they don’t document a function call in the process, so just take it as an explanation of the process. The blue boxes are the most important because they document the function calls. That is, each of the blue boxes represent a function being called that represents an important step in the process of reading the data. Finally, the green boxes represent where the function in the blue box is at in the package structure. This is handy when you want to read through the source code of the function without much hassle.</p>
<p>That said, let’s explore the first step in the process.</p>
</div>
<div id="preparing-and-calling-the-api" class="section level2">
<h2 class="hasAnchor">
<a href="#preparing-and-calling-the-api" class="anchor"></a>Preparing and calling the API</h2>
<p><img src="opendataes_diagram_step1.jpg" width="1100" height="200" style="display: block; margin: auto;"></p>
<p>The first step begins with <code>openes_load</code>, which is the main function. It accepts the typical <code>path_id</code> of the dataset as a string (read the README or other vignette for some simpler cases). For example:</p>
<pre><code>#&gt; 
#&gt; Please cite as:
#&gt; Cimentada, J. and Jorge Lopez (2019). Interact with the datos.gob.es API to download public data from all of Spain R package version 0.0.1</code></pre>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ropenspain/opendataes">opendataes</a></span><span class="op">)</span>

<span class="va">path_id</span> <span class="op">&lt;-</span> <span class="st">'l01080193-resultados-absolutos-de-las-elecciones-al-parlamento-europeo-de-la-ciudad-de-barcelona'</span>
<span class="fu"><a href="../reference/openes_load.html">openes_load</a></span><span class="op">(</span><span class="va">path_id</span><span class="op">)</span></code></pre></div>
<p>However, it also has a method for a dataframe, as the graph suggests. This method is strictly aimed at dataframes returned by <code>openes_keywords</code> so it checks the format of the dataframe before hand.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">openes_load</span>
<span class="co">#&gt; function (x, encoding = "UTF-8", guess_encoding = TRUE, ...) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     x &lt;- if (is.data.frame(x)) </span>
<span class="co">#&gt;         check_keywords_df(x)</span>
<span class="co">#&gt;     else x</span>
<span class="co">#&gt;     UseMethod("openes_load", x)</span>
<span class="co">#&gt; }</span></code></pre></div>
<p><code>openes_load</code> redirects to <code>check_keywords_df</code>, an internal function that checks whether the dataframe has the <code>path_id</code> column, among other checks. Finally, once the check succeeds, it assigns the dataframe a class <code>datos_gob_es_keywords</code> and passes it to the method dispatch <code>UseMethod</code>. The method for the class <code>datos_gob_es_keywords</code> merely subsets the <code>path_id</code> column to get the string and read it using the character method of <code>openes_load</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">opendataes</span><span class="fu">:::</span><span class="va">openes_load.datos_gob_es_keywords</span>
<span class="co">#&gt; function (x, encoding = "UTF-8", guess_encoding = TRUE, ...) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     openes_load(x$path_id, encoding, guess_encoding, ...)</span>
<span class="co">#&gt; }</span></code></pre></div>
<p>So we end up with the same call as if we would’ve called the main argument with a string containing the <code>path_id</code>. As the diagram suggests, you can find these functions in the R script <code>R/openes_load.R</code> in the <a href="https://github.com/ropenspain/opendataes">Github repository</a>. Once <code>openes_load</code> passes the string as the main argument it constructs the whole path for the API using a family of functions found in <code>R/path.R</code>. More concretely, it defines the complete path using <code><a href="../reference/path_dataset_id.html">path_dataset_id(path_id)</a></code> which returns the direct path of the API to query the data set.</p>
<p>At the end of this preprocessing step, <code>openes_load</code> passes this complete path to <code>get_resp</code> which sends a GET request to the API.</p>
<p>We can see the whole process in the character method of <code>openes_load</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">opendataes</span><span class="fu">:::</span><span class="va">openes_load.character</span>
<span class="co">#&gt; function (x, encoding = "UTF-8", guess_encoding = TRUE, ...) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     if (!is.character(x) || length(x) &gt; 1) </span>
<span class="co">#&gt;         stop("`x` must be a character of length 1")</span>
<span class="co">#&gt;     if (!is.character(encoding) || length(encoding) &gt; 1) </span>
<span class="co">#&gt;         stop("`encoding` must be a character of length 1")</span>
<span class="co">#&gt;     if (!is.logical(guess_encoding) || length(guess_encoding) &gt; </span>
<span class="co">#&gt;         1) </span>
<span class="co">#&gt;         stop("`guess_encoding` must be a logical of length 1")</span>
<span class="co">#&gt;     raw_json &lt;- get_resp(path_dataset_id(x))</span>
<span class="co">#&gt;     if (!data_list_correct(raw_json)) </span>
<span class="co">#&gt;         return(list())</span>
<span class="co">#&gt;     data_list &lt;- raw_json$result$items[[1]]</span>
<span class="co">#&gt;     if (!is_publisher_available(data_list)) {</span>
<span class="co">#&gt;         stop("Publisher not available. Please check publishers_available() to get the available ones.")</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     returned_list &lt;- structure(list(metadata = extract_metadata(data_list), </span>
<span class="co">#&gt;         data = suppress_all(extract_data(data_list, encoding, </span>
<span class="co">#&gt;             guess_encoding, ...))), class = "datos_gob_es")</span>
<span class="co">#&gt;     returned_list</span>
<span class="co">#&gt; }</span></code></pre></div>
<p>The function <code>get_resp</code> returns a list with the response from the API, which we’ve interally called a <code>data_list</code>. You will encounter this name in several places in the package as argument names or in the internal documentation. The <code>data_list</code> is just a list that contains the metadata of the dataset and the links to the data from the original publisher (for example, the direct links to the data from the Ayuntamiento de Madrid or Málaga) along with some information from the GET request.</p>
<p>To visualize a real example of a <code>data_list</code> we can call it directly using the previous <code>path_id</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Note that these specific function calls might change in the future,</span>
<span class="co"># but for the sake of showing the format of a data_list we run it.</span>
<span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu">opendataes</span><span class="fu">:::</span><span class="fu"><a href="../reference/get_resp.html">get_resp</a></span><span class="op">(</span><span class="fu">opendataes</span><span class="fu">:::</span><span class="fu"><a href="../reference/path_dataset_id.html">path_dataset_id</a></span><span class="op">(</span><span class="va">path_id</span><span class="op">)</span><span class="op">)</span>
<span class="va">data_list</span>
<span class="co">#&gt; $format</span>
<span class="co">#&gt; [1] "linked-data-api"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $version</span>
<span class="co">#&gt; [1] "0.2"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result</span>
<span class="co">#&gt; $result$`_about`</span>
<span class="co">#&gt; [1] "http://datos.gob.es/apidata/catalog/dataset/l01080193-resultados-absolutos-de-las-elecciones-al-parlamento-europeo-de-la-ciudad-de-barcelona.json"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$definition</span>
<span class="co">#&gt; [1] "http://datos.gob.es/apidata/catalog/meta/dataset/_id.json"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$extendedMetadataVersion</span>
<span class="co">#&gt; [1] "http://datos.gob.es/apidata/catalog/dataset/l01080193-resultados-absolutos-de-las-elecciones-al-parlamento-europeo-de-la-ciudad-de-barcelona.json?_metadata=all"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$first</span>
<span class="co">#&gt; [1] "http://datos.gob.es/apidata/catalog/dataset/l01080193-resultados-absolutos-de-las-elecciones-al-parlamento-europeo-de-la-ciudad-de-barcelona.json?_page=0"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$hasPart</span>
<span class="co">#&gt; [1] "http://datos.gob.es/apidata/catalog/dataset/l01080193-resultados-absolutos-de-las-elecciones-al-parlamento-europeo-de-la-ciudad-de-barcelona.json"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$isPartOf</span>
<span class="co">#&gt; [1] "http://datos.gob.es/apidata/catalog/dataset/l01080193-resultados-absolutos-de-las-elecciones-al-parlamento-europeo-de-la-ciudad-de-barcelona.json"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items</span>
<span class="co">#&gt; $result$items[[1]]</span>
<span class="co">#&gt; $result$items[[1]]$`_about`</span>
<span class="co">#&gt; [1] "http://datos.gob.es/catalogo/l01080193-resultados-absolutos-de-las-elecciones-al-parlamento-europeo-de-la-ciudad-de-barcelona"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$description</span>
<span class="co">#&gt; $result$items[[1]]$description[[1]]</span>
<span class="co">#&gt; $result$items[[1]]$description[[1]]$`_value`</span>
<span class="co">#&gt; [1] "Absolute results of the European Parliament elections of the city of Barcelona"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$description[[1]]$`_lang`</span>
<span class="co">#&gt; [1] "en"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$description[[2]]</span>
<span class="co">#&gt; $result$items[[1]]$description[[2]]$`_value`</span>
<span class="co">#&gt; [1] "Resultados absolutos de las elecciones al Parlamento Europeo de la ciudad de Barcelona"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$description[[2]]$`_lang`</span>
<span class="co">#&gt; [1] "es"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$description[[3]]</span>
<span class="co">#&gt; $result$items[[1]]$description[[3]]$`_value`</span>
<span class="co">#&gt; [1] "Resultats absoluts de les eleccions al Parlament Europeu de la ciutat de Barcelona"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$description[[3]]$`_lang`</span>
<span class="co">#&gt; [1] "ca"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$`_about`</span>
<span class="co">#&gt; [1] "http://datos.gob.es/catalogo/l01080193-resultados-absolutos-de-las-elecciones-al-parlamento-europeo-de-la-ciudad-de-barcelona/resource/2c42d70a-0160-425f-b4b7-5cb600f92f2b"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$accessURL</span>
<span class="co">#&gt; [1] "https://opendata-ajuntament.barcelona.cat/data/dataset/5745630c-77c0-431b-873d-4e83e021ebea/resource/8aa88b93-727b-45be-a11f-5dcea459a47b/download"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$format</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$format[[1]]</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$format[[1]]$`_about`</span>
<span class="co">#&gt; [1] "http://datos.gob.es/catalogo/l01080193-resultados-absolutos-de-las-elecciones-al-parlamento-europeo-de-la-ciudad-de-barcelona/resource/2c42d70a-0160-425f-b4b7-5cb600f92f2b/format"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$format[[1]]$type</span>
<span class="co">#&gt; [1] "http://purl.org/dc/terms/IMT"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$format[[1]]$value</span>
<span class="co">#&gt; [1] "text/csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$format[[2]]</span>
<span class="co">#&gt; [1] "http://publications.europa.eu/resource/authority/file-type/CSV"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$identifier</span>
<span class="co">#&gt; [1] "https://opendata-ajuntament.barcelona.cat/data/dataset/est-eleccions-europees-seccio-censal/resource/8aa88b93-727b-45be-a11f-5dcea459a47b"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$title</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$title[[1]]</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$title[[1]]$`_value`</span>
<span class="co">#&gt; [1] "2014_Eleccions_Parlament_Europeu.csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$title[[1]]$`_lang`</span>
<span class="co">#&gt; [1] "en"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$title[[2]]</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$title[[2]]$`_value`</span>
<span class="co">#&gt; [1] "2014_Eleccions_Parlament_Europeu.csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$title[[2]]$`_lang`</span>
<span class="co">#&gt; [1] "es"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$title[[3]]</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$title[[3]]$`_value`</span>
<span class="co">#&gt; [1] "2014_Eleccions_Parlament_Europeu.csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$title[[3]]$`_lang`</span>
<span class="co">#&gt; [1] "ca"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[1]]$type</span>
<span class="co">#&gt; [1] "http://www.w3.org/ns/dcat#Distribution"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$`_about`</span>
<span class="co">#&gt; [1] "http://datos.gob.es/catalogo/l01080193-resultados-absolutos-de-las-elecciones-al-parlamento-europeo-de-la-ciudad-de-barcelona/resource/42b0250c-bd13-4bc7-890a-33e9dc33b5b0"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$accessURL</span>
<span class="co">#&gt; [1] "https://opendata-ajuntament.barcelona.cat/data/dataset/5745630c-77c0-431b-873d-4e83e021ebea/resource/bd503ce0-2848-4918-b2fd-71325f0d7dcc/download"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$format</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$format[[1]]</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$format[[1]]$`_about`</span>
<span class="co">#&gt; [1] "http://datos.gob.es/catalogo/l01080193-resultados-absolutos-de-las-elecciones-al-parlamento-europeo-de-la-ciudad-de-barcelona/resource/42b0250c-bd13-4bc7-890a-33e9dc33b5b0/format"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$format[[1]]$type</span>
<span class="co">#&gt; [1] "http://purl.org/dc/terms/IMT"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$format[[1]]$value</span>
<span class="co">#&gt; [1] "text/csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$format[[2]]</span>
<span class="co">#&gt; [1] "http://publications.europa.eu/resource/authority/file-type/CSV"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$identifier</span>
<span class="co">#&gt; [1] "https://opendata-ajuntament.barcelona.cat/data/dataset/est-eleccions-europees-seccio-censal/resource/bd503ce0-2848-4918-b2fd-71325f0d7dcc"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$title</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$title[[1]]</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$title[[1]]$`_value`</span>
<span class="co">#&gt; [1] "2019_Eleccions_Parlament_Europeu.csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$title[[1]]$`_lang`</span>
<span class="co">#&gt; [1] "en"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$title[[2]]</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$title[[2]]$`_value`</span>
<span class="co">#&gt; [1] "2019_Eleccions_Parlament_Europeu.csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$title[[2]]$`_lang`</span>
<span class="co">#&gt; [1] "ca"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$title[[3]]</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$title[[3]]$`_value`</span>
<span class="co">#&gt; [1] "2019_Eleccions_Parlament_Europeu.csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$title[[3]]$`_lang`</span>
<span class="co">#&gt; [1] "es"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[2]]$type</span>
<span class="co">#&gt; [1] "http://www.w3.org/ns/dcat#Distribution"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$`_about`</span>
<span class="co">#&gt; [1] "http://datos.gob.es/catalogo/l01080193-resultados-absolutos-de-las-elecciones-al-parlamento-europeo-de-la-ciudad-de-barcelona/resource/48c7c4f9-e356-4801-b6ce-c650a5d85e23"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$accessURL</span>
<span class="co">#&gt; [1] "https://opendata-ajuntament.barcelona.cat/data/dataset/5745630c-77c0-431b-873d-4e83e021ebea/resource/d2350e16-4e9a-47f9-b7ae-6d72ef955371/download"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$format</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$format[[1]]</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$format[[1]]$`_about`</span>
<span class="co">#&gt; [1] "http://datos.gob.es/catalogo/l01080193-resultados-absolutos-de-las-elecciones-al-parlamento-europeo-de-la-ciudad-de-barcelona/resource/48c7c4f9-e356-4801-b6ce-c650a5d85e23/format"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$format[[1]]$type</span>
<span class="co">#&gt; [1] "http://purl.org/dc/terms/IMT"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$format[[1]]$value</span>
<span class="co">#&gt; [1] "text/csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$format[[2]]</span>
<span class="co">#&gt; [1] "http://publications.europa.eu/resource/authority/file-type/CSV"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$identifier</span>
<span class="co">#&gt; [1] "https://opendata-ajuntament.barcelona.cat/data/dataset/est-eleccions-europees-seccio-censal/resource/d2350e16-4e9a-47f9-b7ae-6d72ef955371"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$title</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$title[[1]]</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$title[[1]]$`_value`</span>
<span class="co">#&gt; [1] "2009_Eleccions_Parlament_Europeu.csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$title[[1]]$`_lang`</span>
<span class="co">#&gt; [1] "en"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$title[[2]]</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$title[[2]]$`_value`</span>
<span class="co">#&gt; [1] "2009_Eleccions_Parlament_Europeu.csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$title[[2]]$`_lang`</span>
<span class="co">#&gt; [1] "ca"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$title[[3]]</span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$title[[3]]$`_value`</span>
<span class="co">#&gt; [1] "2009_Eleccions_Parlament_Europeu.csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$title[[3]]$`_lang`</span>
<span class="co">#&gt; [1] "es"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$distribution[[3]]$type</span>
<span class="co">#&gt; [1] "http://www.w3.org/ns/dcat#Distribution"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$identifier</span>
<span class="co">#&gt; [1] "https://opendata-ajuntament.barcelona.cat/data/dataset/est-eleccions-europees-seccio-censal"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$issued</span>
<span class="co">#&gt; [1] "mié, 13 mar 2013 23:00:00 GMT+0000"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$keyword</span>
<span class="co">#&gt; $result$items[[1]]$keyword[[1]]</span>
<span class="co">#&gt; [1] "Absolutos"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$keyword[[2]]</span>
<span class="co">#&gt; [1] "Año 2009"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$keyword[[3]]</span>
<span class="co">#&gt; [1] "Año 2014"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$keyword[[4]]</span>
<span class="co">#&gt; [1] "Año 2019"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$keyword[[5]]</span>
<span class="co">#&gt; [1] "Barrio"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$keyword[[6]]</span>
<span class="co">#&gt; [1] "Barrios Barcelona"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$keyword[[7]]</span>
<span class="co">#&gt; [1] "Elecciones europeas"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$keyword[[8]]</span>
<span class="co">#&gt; [1] "Secciones censales"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$publisher</span>
<span class="co">#&gt; [1] "http://datos.gob.es/recurso/sector-publico/org/Organismo/L01080193"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$references</span>
<span class="co">#&gt; $result$items[[1]]$references[[1]]</span>
<span class="co">#&gt; [1] "https://www.bcn.cat/estadistica/angles/dades/telec/eur/index.htm"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$references[[2]]</span>
<span class="co">#&gt; [1] "https://www.bcn.cat/estadistica/castella/dades/telec/eur/index.htm"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$references[[3]]</span>
<span class="co">#&gt; [1] "https://www.bcn.cat/estadistica/catala/dades/telec/eur/index.htm"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$theme</span>
<span class="co">#&gt; [1] "http://datos.gob.es/kos/sector-publico/sector/sector-publico"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$title</span>
<span class="co">#&gt; $result$items[[1]]$title[[1]]</span>
<span class="co">#&gt; $result$items[[1]]$title[[1]]$`_value`</span>
<span class="co">#&gt; [1] "Absolute results of the European Parliament elections of the city of Barcelona"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$title[[1]]$`_lang`</span>
<span class="co">#&gt; [1] "en"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$title[[2]]</span>
<span class="co">#&gt; $result$items[[1]]$title[[2]]$`_value`</span>
<span class="co">#&gt; [1] "Resultados absolutos de las elecciones al Parlamento Europeo de la ciudad de Barcelona"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$title[[2]]$`_lang`</span>
<span class="co">#&gt; [1] "es"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$title[[3]]</span>
<span class="co">#&gt; $result$items[[1]]$title[[3]]$`_value`</span>
<span class="co">#&gt; [1] "Resultats absoluts de les eleccions al Parlament Europeu de la ciutat de Barcelona"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$title[[3]]$`_lang`</span>
<span class="co">#&gt; [1] "ca"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$items[[1]]$type</span>
<span class="co">#&gt; [1] "http://www.w3.org/ns/dcat#Dataset"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$itemsPerPage</span>
<span class="co">#&gt; [1] 10</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$page</span>
<span class="co">#&gt; [1] 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$startIndex</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$type</span>
<span class="co">#&gt; $result$type[[1]]</span>
<span class="co">#&gt; [1] "http://purl.org/linked-data/api/vocab#ListEndpoint"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $result$type[[2]]</span>
<span class="co">#&gt; [1] "http://purl.org/linked-data/api/vocab#Page"</span></code></pre></div>
<p>Before we extract the metadata and data, <code>openes_load</code> checks that the <code>data_list</code> is in the expected format, because otherwise none of the functions in the package would work. If the <code>data_list</code> is not in the correct format, <code>openes_load</code> returns an empty list.</p>
<p><strong>Note</strong>: <code>opendataes</code> really pushes for consistent outputs. That is, it usually returns a list with two slots containing the metadata and data and if the data poses some sort of problem, <code>openes_load</code> should return the same list with two slots but without the data itself. However, if the <code>data_list</code> is not in the correct format it means that the API is returning something odd in the first place. This is regardless of the quality, standardization or format of the dataset. In this scenario <code>openes_load</code> returns an empty list but this is open to debate. This is an area for improvements for new comers.</p>
<p>Getting back to the <code>data_list</code>, it is messy and not very intuitive. This is when we move to the second step of the diagram.</p>
</div>
<div id="extracting-the-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-the-metadata" class="anchor"></a>Extracting the metadata</h2>
<p><img src="opendataes_diagram_step2.jpg" width="900" height="300" style="display: block; margin: auto;"></p>
<p>The metadata is scattered around the <code>data_list</code> but it keeps consistent names so <code>opendataes</code> provides several <code>extract_*</code> functions that are present in the diagram. We combine all of these ‘helper’ functions into <code>extract_metadata</code> to provide a general <code>tibble</code> of metadata. In the example below, we need to dig deeper into the list structure of <code>data_list</code> to get to where the data actually is.</p>
<p>For example..</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># This is the slot where the data is. This is the case</span>
<span class="co"># even when there are several datasets to read.</span>
<span class="co"># It is safe only to search HERE for the data</span>
<span class="co"># and metadata</span>
<span class="va">data_list</span> <span class="op">&lt;-</span> <span class="va">data_list</span><span class="op">$</span><span class="va">result</span><span class="op">$</span><span class="va">items</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>

<span class="fu">opendataes</span><span class="fu">:::</span><span class="fu"><a href="../reference/extract_metadata.html">extract_metadata</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3 x 8</span>
<span class="co">#&gt;   keywords language description url   date_issued         date_modified</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;dttm&gt;              &lt;chr&gt;        </span>
<span class="co">#&gt; 1 Absolut… en       Absolute r… http… 2013-03-13 23:00:00 No modificat…</span>
<span class="co">#&gt; 2 Absolut… es       Resultados… http… 2013-03-13 23:00:00 No modificat…</span>
<span class="co">#&gt; 3 Absolut… ca       Resultats … http… 2013-03-13 23:00:00 No modificat…</span>
<span class="co">#&gt; # … with 2 more variables: publisher &lt;chr&gt;, publisher_data_url &lt;chr&gt;</span></code></pre></div>
<p>Inside this function we’re just calling separate <code>extract_*</code> functions to grab each piece of metadata. For example..</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">keywords</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_keywords.html">extract_keywords</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span>
<span class="va">description</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_description.html">extract_description</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span>
<span class="va">languages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_language.html">extract_language</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span>
<span class="va">url_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_url.html">extract_url</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span></code></pre></div>
<p>Once that’s done, the metadata is ready. For more detailed readings of the source code, each of these functions are located in the <code>R/extract.R</code> path. Now we move on to the trickiest step: extracting the data.</p>
</div>
<div id="extracting-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-the-data" class="anchor"></a>Extracting the data</h2>
<p><img src="opendataes_diagram_step3.jpg" width="1300" height="600" style="display: block; margin: auto;"></p>
<p>The first step is passing the <code>data_list</code> from above to <code>extract_data</code> which can be located at the path <code>R/extract.R</code>. The difficult part of reading the data is due to the fact that different publishers keep datasets with different formats. For example, the Ayuntamiento de Madrid might have a <code>csv</code> file with only one excel sheet in an organized tabular format but the Ayuntamiento de Arganda del Rey might have several sheets with several tables inside each sheet. There’s really nothing that can be done about that if the aim of the package is to scale the data reading process across several publishers. The chosen solution, we believe, is the most conservative: limit the publishers and formats that <code>opendataes</code> can read and increase these two as their standardization practices grow.</p>
<p>The first step that <code>openes_load</code> takes <strong>before calling</strong> <code>extract_data</code> functions is to check whether the data comes from our permitted publishers. If the dataset is not from an available publisher, it raises an error. This is done via <code>opendataes:::is_publisher_available</code> which extracts the publisher from the <code>data_list</code> and matches it with our list of available publishers.</p>
<p>The criteria we think best to include new publishers is to check by brute force whether they have patterns of standardization. For example, the first publisher we accepted as reliable was ‘Ayuntamiento of Barcelona’ because we repeatedly found ourselves reading datasets from the same format which were very consistent and easy to read. For the list of available publishers that <code>opendataes</code> can read, we can look at <code><a href="../reference/publishers_available.html">opendataes::publishers_available</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">publishers_available</span>
<span class="co">#&gt; # A tibble: 10 x 2</span>
<span class="co">#&gt;    publishers                                 publisher_code</span>
<span class="co">#&gt;    &lt;chr&gt;                                      &lt;chr&gt;         </span>
<span class="co">#&gt;  1 Ayuntamiento de Barcelona                  L01080193     </span>
<span class="co">#&gt;  2 Ayuntamiento de Madrid                     L01280796     </span>
<span class="co">#&gt;  3 Ayuntamiento de Valencia                   L01462508     </span>
<span class="co">#&gt;  4 Ayuntamiento de Las Palmas de Gran Canaria L01350167     </span>
<span class="co">#&gt;  5 Ayuntamiento de Bilbao                     L01480209     </span>
<span class="co">#&gt;  6 Ayuntamiento de Zaragoza                   L01502973     </span>
<span class="co">#&gt;  7 Ayuntamiento de Malaga                     L01290672     </span>
<span class="co">#&gt;  8 Ayuntamiento de Gijon                      L01330241     </span>
<span class="co">#&gt;  9 Ayuntamiento de Santander                  L01390759     </span>
<span class="co">#&gt; 10 Ayuntamiento de Alcobendas                 L01280066</span></code></pre></div>
<p>This is one of the main areas were <code>opendataes</code> needs support. We are always welcoming pull requests that would allow us to read new publishers as long as we can have some sort of proof of consistency in their datasets.</p>
<p>The second problem, and very related to the previous, is the formats that <code>opendataes</code> can read. Because standardization across datasets is one of our main concerns, we are interested in reading formats which are consistent and predictable for reading purposes. Fortunately, around 70% of all datasets in <code>datos.gob.es</code> are <code>csv</code> files, a very standard format. For that reason, it is the first format that we give preference for reading. You can check the permitted formats with <code><a href="../reference/permitted_formats.html">opendataes::permitted_formats</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">permitted_formats</span>
<span class="co">#&gt; [1] "csv"</span></code></pre></div>
<p>This is one are where we are actively looking for new pull requests as we are interested in broadening the scope of formats that <code>opendataes</code> can read.</p>
<p>From the package’s perspective there are two things that can be done to further increase the number of publishers and formats: push each of our publishers for greater standardization and check whether we can read a reasonable number of file formats from a given publisher.</p>
<p>Having said that, the first thing that <code>extract_data</code> does is to check whether the selected dataset has any of the formats that <code>opendataes</code> can read. If it doesn’t, then it doesn’t attempt to read anything but merely returns the dataset’s URL’s in all the formats available. For example it returns a tibble like this one..</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># $`unavailable_formats`</span>
<span class="co"># A tibble: 13 x 3</span>
<span class="co">#   name                       format URL                                                                           </span>
<span class="co">#   &lt;chr&gt;                      &lt;chr&gt;  &lt;chr&gt;                                                                         </span>
<span class="co"># 1 2018_3T_CARRIL_BICI_CONST~ zip    http://opendata-ajuntament.barcelona.cat/resources/bcn/2018_3T_CARRIL_BICI_CO~</span>
<span class="co"># 2 CARRIL_BICI_CONSTRUCCIO.s~ NA     http://opendata-ajuntament.barcelona.cat/resources/bcn/CARRIL_BICI_CONSTRUCCI~</span>
<span class="co"># 3 CARRIL_BICI_CONSTRUCCIO.p~ asc    http://opendata-ajuntament.barcelona.cat/resources/bcn/CARRIL_BICI_CONSTRUCCI~</span>
<span class="co"># 4 2018_2T_CARRIL_BICI_CONST~ zip    http://opendata-ajuntament.barcelona.cat/resources/bcn/2018_2T_CARRIL_BICI_CO~</span>
<span class="co"># 5 CARRIL_BICI_CONSTRUCCIO.g~ json   http://opendata-ajuntament.barcelona.cat/resources/bcn/CARRIL_BICI_CONSTRUCCI~</span>
<span class="co"># 6 CARRIL_BICI_CONSTRUCCIO.z~ zip    http://opendata-ajuntament.barcelona.cat/resources/bcn/CARRIL_BICI_CONSTRUCCI~</span>
<span class="co"># 7 2017_4T_CARRIL_BICI_CONS.~ zip    http://opendata-ajuntament.barcelona.cat/data/dataset/edee68e3-5ff1-43d0-b556~</span>
<span class="co"># 8 2018_1T_CARRIL_BICI_CONS.~ zip    http://opendata-ajuntament.barcelona.cat/data/dataset/edee68e3-5ff1-43d0-b556~</span>
<span class="co"># 9 2017_3T_CARRIL_BICI_CONS.~ zip    http://opendata-ajuntament.barcelona.cat/data/dataset/edee68e3-5ff1-43d0-b556~</span>
<span class="co"># 10 CARRIL_BICI_CONSTRUCCIO.d~ asc    http://opendata-ajuntament.barcelona.cat/resources/bcn/CARRIL_BICI_CONSTRUCCI~</span>
<span class="co"># 11 CARRIL_BICI_CONSTRUCCIO.s~ NA     http://opendata-ajuntament.barcelona.cat/resources/bcn/CARRIL_BICI_CONSTRUCCI~</span>
<span class="co"># 12 2017_2T_CARRIL_BICI_CONS.~ zip    http://opendata-ajuntament.barcelona.cat/data/dataset/edee68e3-5ff1-43d0-b556~</span>
<span class="co"># 13 2017_1T_CARRIL_BICI_CONS.~ zip    http://opendata-ajuntament.barcelona.cat/data/dataset/edee68e3-5ff1-43d0-b556~</span></code></pre></div>
<p>where the user would get each file name with it’s format and direct URL, in case they want to read it manually. In case the dataset has at least <strong>one</strong> of the permitted formats, then the process is different: <code>extract_data</code> extracts all URL’s of the permitted format. As an ilustrative example, a dataset could have several files as can be seen in the image below:</p>
<p><img src="datos_formats.png" width="1200" height="600" style="display: block; margin: auto;"></p>
<p>The above image shows the accidents in the city of Barcelona for years 2010, 2011, etc.. where each of these datasets is in <code>csv</code>, <code>xlsx</code> and <code>xml</code> formats. What <code>extract_data</code> does is pick the permitted format in the order of preference of <code><a href="../reference/permitted_formats.html">opendataes::permitted_formats</a></code> and extract all of the URL’s for that format. In this case, it would extract all of the URL’s for the accidents in <code>csv</code> for the year 2010, 2011, etc..</p>
<p>Once those URL’s are extracted, a loop begins for each of the URL’s where each URL is passed to <code>read_generic</code>, located at <code>R/read_generic.R</code>, to determine the function to read the data based on the format. Once the function is determined, <code>read_generic</code> attempts to read the URL. If for any reason reading the data raises an error, inside the same loop, <code>extract_datos</code> merely records the format and URL and returns a dataframe with the info that it attempted to read. This is done to preserve the structure of the results and to give the user the option to try to read it manually. If the reading process was successful, then it simply returns the data as a <code>tibble</code>.</p>
<p>This is what really happens behind the scenes with commented code:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># If there is any format to read continue, otherwise return</span>
<span class="co"># A dataset with all formats and their respective URL</span>

<span class="co"># is_file_readable here contains the formats that matched between</span>
<span class="co"># the data_list and the permitted_formats</span>
<span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">is_file_readable</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># Determine the NAME of the datafiles</span>
  <span class="va">names_datasets</span> <span class="op">&lt;-</span> <span class="fu">determine_dataset_name</span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span>
  
  <span class="co"># Make sure the URL's and dataset names are in the same order.</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">names_datasets</span> <span class="op">==</span> <span class="va">is_file_readable</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Data cannot be read because it is not in correct order"</span><span class="op">)</span>
  
  <span class="co"># Create empty list to fill it with the data</span>
  <span class="va">output_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">is_file_readable</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># Loop over the index of each URL</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">index</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">is_file_readable</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># Grab the URL</span>
    <span class="va">data_url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">is_file_readable</span><span class="op">)</span><span class="op">[</span><span class="va">index</span><span class="op">]</span>
    <span class="co"># Determine the read_ function to be used from the format of the URL</span>
    <span class="va">read_generic</span> <span class="op">&lt;-</span> <span class="fu">determine_read_generic</span><span class="op">(</span><span class="va">data_url</span><span class="op">)</span>
    <span class="co"># Because there are different languages in Spain, set the encoding</span>
    <span class="co"># to be used when reading the dataset. This is where the encoding argument</span>
    <span class="co"># is passed to</span>
    <span class="va">custom_locale</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/locale.html">locale</a></span><span class="op">(</span><span class="st">"es"</span>, encoding <span class="op">=</span> <span class="va">encoding</span><span class="op">)</span>
    
    <span class="co"># Try reading the data and saving it in that dataset's slot</span>
    <span class="co"># in the list</span>
    <span class="va">output_data</span><span class="op">[[</span><span class="va">index</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">read_generic</span><span class="op">(</span>file <span class="op">=</span> <span class="va">data_url</span>, locale <span class="op">=</span> <span class="va">custom_locale</span>, <span class="va">...</span><span class="op">)</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
    
    <span class="co"># If there was an error reading the dataset, fill the same slot</span>
    <span class="co"># with the format and URL that it attempted to read.</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html">inherits</a></span><span class="op">(</span><span class="va">output_data</span><span class="op">[[</span><span class="va">index</span><span class="op">]</span><span class="op">]</span>, <span class="st">"try-error"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">output_data</span><span class="op">[[</span><span class="va">index</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>format <span class="op">=</span> <span class="va">is_file_readable</span><span class="op">[</span><span class="va">index</span><span class="op">]</span>, 
                                             URL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">is_file_readable</span><span class="op">[</span><span class="va">index</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>
  <span class="co"># Assign the names of each data slot so that users can identify which</span>
  <span class="co"># name belongs to which dataset.</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">output_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">names_datasets</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The process explained above is very messy because of the main problem discussed above: not all datasets are standardized. For example, in one of the <code>csv</code> files from above there could’ve been a starting blank line whereas in the second dataset there was no such line. Manually, this is easy to handle by just providing an argument such as <code>skip</code> to skip the first line. However, once we scale it to different datasets which don’t have a standardized structure, it becomes very messy.</p>
<p>Providing specific arguments to each dataset being read would be too difficult considering that the user never knows the order at which each of the datasets are being read. Moreover, in order for the user to know which arguments should be passed to each dataset, the user would have had to read the data manually in the first place which really misses the whole point of streamlining the process of reading the data automatically.</p>
<p>As a partial solution, <code>opendataes</code> provides the <code>...</code> argument in <code>openes_load</code> to allow the user to pass generic arguments to all datasets. In a similar line, <code>openes_load</code> allows the user to pass the <code>encoding</code> argument which is passed to the <code>read_generic</code> function when it is appropriate. Of course, any argument passed to <code>...</code> or <code>encoding</code> will be applied to all datasets being read. Once this process is over, <code>extract_data</code> will always return a list with <code>tibble</code>’s where each <code>tibble</code> could be the data itself or a <code>tibble</code> with the link and format that <code>read_generic</code> attempted to read but failed for some reason.</p>
<p>The final step is merely joining both the <code>metadata</code> and <code>data</code> into a list as the below image shows:</p>
<p><img src="opendataes_diagram_step4.jpg" width="300" height="200" style="display: block; margin: auto;"></p>
<p>This vignette was written as the package became public and the structure might get outdated as time passes by. We aim for the package to grow through new contributors. The package is accepting pull requests and it is open to new features so feel free to file an issue to discuss new ideas at the Github repository <a href="https://github.com/cimentadaj/opendataes">here</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>




      <footer id="footer"><div class="container">
		<div class="col-md-3 col-sm-6 col-md-offset-1">
			<h4 data-toc-skip>About opendataes</h4>
			Developed by <a href="https://cimentadaj.github.io/">Jorge Cimentada</a>, <a href="http://jorgelopezperez.com/">Jorge Lopez</a>, part of the <span class="ROS-light">rOpenSpain</span> project.
			<hr class="hidden-md hidden-lg hidden-sm">
</div>
		<div class="col-md-3 col-sm-6 col-md-offset-4">
			<h4 data-toc-skip>About <img src="../ROS-logo.png" alt="ROpenSpain Logo" height="24"><span class="ROS-light"> rOpenSpain</span>
</h4>
			<a href="https://ropenspain.es/"><span class="ROS-light">rOpenSpain</span></a> is a community of R enthusiasts whose ultimate goal is to create high-quality R packages for data mining public spanish open sources.
			<hr class="hidden-md hidden-lg hidden-sm">
</div>
	</div>
</footer><div id="copyright">
	<div class="container">
		<div class="col-md-12">
			<p class="pull-left">
			Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.
			</p>
			<p class="pull-right">
			Template by <a href="https://bootstrapious.com/snippets">Bootstrapious </a>.
			Ported to pkgdown by <a href="https://github.com/dieghernan/">dieghernan</a>.
			</p>
		</div>
	</div>
</div>

<!-- ropenspain -->
<script src="../ropenspain.js"></script>
</div>
   
  


  </body>
</html>
